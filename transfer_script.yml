---
- name: Transfer and run Python script
  hosts: all
  gather_facts: no
  vars:
    python_script_path: "http://192.168.47.78/Software/Scripts/Linux_Scripts/Ansible_Scripts/"  # Windows 共享路径
    python_script_name: 'update_software.py'  # Python 脚本文件名
    excel_file_name: '1.xlsx'      # Excel 文件名
    local_python_script: "/tmp/{{ python_script_name }}"  # 本地保存的 Python 脚本路径
    local_excel_file: "/tmp/{{ excel_file_name }}"      # 本地保存的 Excel 文件路径
  tasks:
    - name: Download Python Script #下载python脚本
      get_url:  #get url模块
        url: "{{ python_script_path }}/{{ python_script_name }}"  #python所在路径
        dest: "{{ local_python_script }}"  #python放在哪个路径下
      register: python_script_result   #下载结果存放在python_script_result变量中

    - name: Install pymysql module
      pip:
        name: pymysql


    - name: Run Python script
      command: "python3 {{ local_python_script }}"
      register: python_output

    - name: Show Python script output
      debug:
        msg: "{{ python_output.stdout }}"
      
